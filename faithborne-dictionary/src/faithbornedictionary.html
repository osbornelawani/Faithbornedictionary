<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faithborne Dictionary</title>
<link rel="stylesheet" href="themes/theme1.css" id="themeStylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f5f7fa;
    background-size: cover;
    background-position: center;
    transition: background 0.5s ease;
    color:#333;
}
header {text-align:center; padding:20px; background:#4facfe; color:white; box-shadow:0 2px 6px rgba(0,0,0,0.2);}
header h1 {margin:0; font-size:2em;}
nav {text-align:center; margin:15px;}
nav button {margin:5px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; background:#0078ff; color:white;}
nav button:disabled {background:#ccc; color:#888; cursor:not-allowed;}
nav button:hover:enabled {background:#005fcc;}
main {padding:20px; max-width:1000px; margin:auto;}
.controls {display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; align-items:center;}
input, button {padding:8px; border-radius:6px; border:1px solid #ccc; font-size:1em;}
button.addBtn {background:#28a745; color:white; border:none;}
button.addBtn:hover {background:#1e7e34;}
button.loginBtn {background:#f39c12; color:white; border:none;}
button.loginBtn:hover {background:#d35400;}
button.logoutBtn {background:#e74c3c; color:white; border:none;}
button.logoutBtn:hover {background:#c0392b;}
table {width:100%; border-collapse:collapse; margin-top:10px;}
th, td {padding:10px; text-align:left; border-bottom:1px solid #ccc;}
th {background:#0078ff; color:white;}
tr:nth-child(even) {background:#f2f2f2;}
tr.highlight {background-color:#ffff99;}
button.editBtn {background:#007bff; color:white; border:none; padding:5px 10px; margin-right:5px;}
button.editBtn:hover {background:#0056b3;}
button.saveBtn {background:#28a745; color:white; border:none; padding:5px 10px; margin-right:5px;}
button.saveBtn:hover {background:#1e7e34;}
button.deleteBtn {background:#ff4b5c; color:white; border:none; padding:5px 10px;}
button.deleteBtn:hover {background:#c0392b;}
button.exportBtn {background:#6c5ce7; color:white; border:none; padding:8px 15px; margin-top:10px; margin-right:5px;}
button.exportBtn:hover {background:#341f97;}
.hidden {display:none;}
.word-card, .meaning-card {position:relative;}
.word-card-selected {border:3px solid yellow !important;}
.card, table, input, button {
    background-color: rgba(255,255,255,0.85);
    color: #333;
    border-radius: 8px;
    transition: background 0.3s, color 0.3s;
}
.dark-text { color: white; }
</style>
</head>
<body>

<header>
  <h1>üìñ Faithborne Dictionary</h1>
</header>

<!-- Site-wide theme controls -->
<div style="margin:10px; text-align:center;">
  <label style="color:#333;">üåà Site Theme: </label>
  <select id="themeSelector" onchange="changeTheme()">
    <option value="themes/theme1.css">Theme 1</option>
    <option value="themes/theme2.css">Theme 2</option>
    <option value="themes/theme3.css">Theme 3</option>
    <option value="themes/theme4.css">Theme 4</option>
    <option value="themes/theme5.css">Theme 5</option>
    <option value="themes/theme6.css">Theme 6</option>
    <option value="themes/theme7.css">Theme 7</option>
    <option value="themes/theme8.css">Theme 8</option>
    <option value="themes/theme9.css">Theme 9</option>
    <option value="themes/theme10.css">Theme 10</option>
    <option value="themes/theme11.css">Theme 11</option>
    <option value="themes/theme12.css">Theme 12</option>
    <option value="themes/theme13.css">Theme 13</option>
    <option value="themes/theme14.css">Theme 14</option>
    <option value="themes/theme15.css">Theme 15</option>
    <option value="themes/theme16.css">Theme 16</option>
    <option value="themes/theme17.css">Theme 17</option>
    <option value="themes/theme18.css">Theme 18</option>
    <option value="themes/theme19.css">Theme 19</option>
    <option value="themes/theme20.css">Theme 20</option>
  </select>
  <button onclick="resetTheme()">Reset Theme</button>
</div>

<nav>
  <button id="addWordsBtn" onclick="showPage('inputPage')">‚ûï Add Words</button>
  <button id="viewEntriesBtn" onclick="showPage('entriesPage')" disabled>üìÇ View Entries</button>
  <button id="gamesBtn" onclick="showPage('gamesPage')" disabled>üéÆ Games</button>
</nav>

<main id="inputPage">
  <div class="controls">
    <button id="loginBtn" class="loginBtn" onclick="googleLogin()">Login with Google</button>
    <button id="logoutBtn" class="logoutBtn hidden" onclick="logout()">Logout</button>
    <span id="userName" style="margin-left:10px; font-weight:bold;"></span>
  </div>
  <h2>Add a New Word</h2>
  <div class="controls">
    <input type="text" id="word" placeholder="Enter word...">
    <input type="text" id="meaning" placeholder="Enter meaning...">
    <button class="addBtn" onclick="addWord()">Add</button>
  </div>
  <h3>üîç Quick Search</h3>
  <div class="controls">
    <input type="text" id="searchInputPage" placeholder="Search word or meaning..." oninput="quickSearch()">
  </div>
  <ul id="quickResults"></ul>
</main>

<main id="entriesPage" class="hidden">
  <h2>üìÇ Dictionary Entries</h2>
  <div class="controls">
    <input type="text" id="entriesSearch" placeholder="Search word or meaning..." oninput="renderEntries()">
  </div>
  <table id="entriesTable">
    <thead>
      <tr>
        <th>Word</th>
        <th>Meaning</th>
        <th>Inputer</th>
        <th>Date & Time</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="exportBtn" onclick="exportData('csv')">‚¨á Export CSV</button>
  <button class="exportBtn" onclick="exportData('pdf')">‚¨á Export PDF</button>
</main>

<!-- GAMES PAGE -->
<main id="gamesPage" class="hidden">
  <h2 style="text-align:center; color:#6c5ce7;">üéÆ Dictionary Games Hub</h2>
  <div style="margin:10px; text-align:center;">
    <label style="color:white;">üé® Set Games Background: </label>
    <input type="file" id="bgUpload" accept="image/*">
    <button onclick="setCustomBackground()">Apply</button>
  </div>
  <div class="games-container" style="display:flex; flex-direction:column; gap:20px; align-items:center; justify-content:center; min-height:80vh; 
      background: linear-gradient(to top, #8ecae6, #219ebc); 
      background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1350&q=80'); 
      background-size: cover; background-position: center; padding:20px; border-radius:12px;">
    <button class="addBtn" onclick="startGame('matching')">üî§ Match Word with Meaning</button>
    <button class="addBtn" onclick="startGame('quiz')">‚ùì Multiple Choice Quiz</button>
    <button class="addBtn" onclick="startGame('typing')">‚å®Ô∏è Typing Challenge</button>
  </div>
  <div id="gameScreen" class="hidden" style="margin-top:20px;"></div>
  <button id="backFromGame" class="logoutBtn hidden" onclick="backToGames()" style="margin-top:20px;">‚¨Ö Back to Games Hub</button>
  <h3 style="color:#6c5ce7;">Leaderboard</h3>
  <ul id="leaderboardList"></ul>
</main>

<script>
let currentGame = null;
let leaderboard = {};
let sampleWords = [
    {word:"Euphoria", meaning:"A feeling of intense happiness"},
    {word:"Serendipity", meaning:"Finding something good by chance"},
    {word:"Ephemeral", meaning:"Lasting for a very short time"},
    {word:"Melancholy", meaning:"A feeling of deep sadness"},
    {word:"Luminous", meaning:"Emitting light"},
    {word:"Apple", meaning:"A fruit"},
    {word:"Ocean", meaning:"Large body of water"},
    {word:"Sun", meaning:"The star at the center of our solar system"},
    {word:"Tree", meaning:"A plant with a trunk and branches"},
    {word:"Book", meaning:"A set of pages with information or story"}
];

// ----- Sound Effects -----
// (Sound effects code remains unchanged)

// ----- Custom Background for Games -----
// (Custom background code remains unchanged)

// ----- Site-wide Theme -----
// (Theme functions remain unchanged)

function changeTheme() {
    const theme = document.getElementById("themeSelector").value;
    document.getElementById("themeStylesheet").setAttribute("href", theme);
}

// ----- Get 5 random words from both sampleWords and user entries -----
// (Game words function remains unchanged)

// ----- Game functions -----
// (Game functions remain unchanged)

// ----- Updated Leaderboard -----
// (Leaderboard functions remain unchanged)

// ====== MAIN DICTIONARY CODE ======
// (Firebase configuration and main code remains unchanged)

// ----- Leaderboard persistence in Firebase -----
function updateLeaderboard(username, score, gameType='general'){
    const leaderboardRef = db.collection("leaderboard").doc(gameType);
    leaderboardRef.get().then(doc => {
        if (doc.exists) {
            const data = doc.data();
            if (!data[username]) {
                data[username] = score;
            } else {
                data[username] = Math.max(data[username], score);
            }
            leaderboardRef.set(data);
        } else {
            leaderboardRef.set({ [username]: score });
        }
        renderLeaderboard(gameType);
    });
}

function renderLeaderboard(gameType) {
    const leaderboardRef = db.collection("leaderboard").doc(gameType);
    leaderboardRef.get().then(doc => {
        const list = document.getElementById("leaderboardList");
        list.innerHTML = `<h4 style='color:#fff;'>${gameType.toUpperCase()} Leaderboard</h4>`;
        const data = doc.data();
        const sortedEntries = Object.entries(data).sort((a, b) => b[1] - a[1]);
        sortedEntries.forEach(([user, score]) => {
            const li = document.createElement("li");
            li.textContent = `${user}: ${score}`;
            li.style.color = "#ffeb3b";
            list.appendChild(li);
        });
    });
}

// Auto-sync Firestore
db.collection("entries").orderBy("timestamp","desc").onSnapshot(snapshot => {
    cachedEntries = [];
    snapshot.forEach(doc => {
        cachedEntries.push({id: doc.id, ...doc.data()});
    });
    if (!document.getElementById("entriesPage").classList.contains("hidden")) renderEntries();
});

// Load leaderboard data on page load
window.onload = () => {
    renderLeaderboard('general');
};
</script>

</body>
</html>